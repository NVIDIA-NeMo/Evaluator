# SPDX-FileCopyrightText: Copyright (c) 2025, NVIDIA CORPORATION. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# How to use:
#
# 1. copy this file locally or clone the repository
# 2. (optional) uncomment limit_samples in the config file to run with 10 samples for quick testing
# 3. run `nemo-evaluator-launcher run --config path/to/local_advanced_adapters.yaml`

# ⚠️  WARNING:
#     Always run full evaluations (without limit_samples) for actual benchmark results.
#     Using a subset of samples is solely for testing configuration and setup.
#     Results from such test runs should NEVER be used to compare models or
#     report benchmark performance.


# [docs-start-snippet]
defaults:
  - execution: local
  - deployment: none
  - _self_

execution:
  output_dir: nel-results


target:
  api_endpoint:
    # see https://build.nvidia.com/bytedance/seed-oss-36b-instruct for endpoint details
    model_id: bytedance/seed-oss-36b-instruct
    url: https://integrate.api.nvidia.com/v1/chat/completions
    api_key_name: NGC_API_KEY  # API Key with access to build.nvidia.com


# specify the benchmarks to evaluate
evaluation:
  tasks:
    - name: mgsm
      nemo_evaluator_config:
        config: # global config settings that apply to all tasks
          params:
            request_timeout: 3600  # timeout for API request in seconds
            parallelism: 1  # 1 parallel request to avoid overloading the server
            # limit_samples: 10 # uncomment to limit number of samples for quick testing
        target:
          api_endpoint:
            adapter_config:
              interceptors:
                - name: "payload_modifier"  # modifies API request payload with custom parameters
                  config:
                    # these parameters will disable reasoning
                    params_to_add:
                      extra_body:
                        chat_template_kwargs:
                          enable_thinking: false
                        thinking_budget: -1
                - name: system_message  # injects a system message to guide model behavior
                  enabled: true
                  config:
                    system_message: |
                      You are an expert mathematician and problem solver. When presented with a math problem:

                      1. Read the problem carefully and understand what is being asked
                      2. Break down the problem into smaller, manageable steps
                      3. Show your reasoning clearly and logically
                      4. Use appropriate mathematical notation and methods
                      5. Double-check your work for accuracy
                      6. Present your final answer clearly within \boxed{} tags

                      Always think step by step and be thorough in your explanations.
                - name: request_logging  # logs API requests for debugging and monitoring
                  enabled: true
                  config:
                    max_requests: 1  # limit number of requests to log

                - name: caching  # caches API responses to avoid redundant calls
                  enabled: true
                  config:
                    cache_dir: /results/cache
                    reuse_cached_responses: true

                - name: endpoint  # handles actual API communication
                  enabled: true
                - name: response_stats  # collects statistics about API responses
                  enabled: true
