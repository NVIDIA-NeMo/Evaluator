global
    log stdout format raw local0
    maxconn 4096

defaults
    log     global
    mode    http
    option  httplog
    timeout connect 5s
    timeout client  30s
    timeout server  30s

frontend service_frontend
    bind *:{{ haproxy_port }}
    default_backend service_backend

backend service_backend
    mode http
    option httpchk GET {{ health_check_path }}
    http-check expect status {{ health_check_status }}
    balance roundrobin
{% for node in nodes %}
    server node{{ loop.index }} {{ node.ip }}:{{ node.port }} check
{% endfor %}
