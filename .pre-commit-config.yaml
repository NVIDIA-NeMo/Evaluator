# Copyright (c) 2025, NVIDIA CORPORATION.  All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.4.0
    hooks:
    - id: end-of-file-fixer
      # only include python files
      files: \.py$
    - id: trailing-whitespace
      # only include python files
      files: \.py$

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: "v0.9.9" # Use the appropriate version
    hooks:
    - id: ruff
      args: ["--fix"]
    - id: ruff
      args: ["check", "--select", "I", "--fix"]
    - id: ruff-format

  - repo: local
    hooks:
      - id: no-underscore-md
        name: "Disallow '_' in Markdown filenames"
        language: system
        entry: |
          bash -c '
            # Report the offending files
            echo "[pre-commit] ERROR: Found Markdown files with underscores:" >&2
            for file in "$@"; do
              echo "  - $file (use hyphens instead)" >&2
            done
            exit 1
          '
        files: '.*\/[^\/]*_[^\/]*\.md$'
        exclude: '^\.github/'
        types: [file]
      # Workflow diagram:
      # mapping.toml
      # (container = "..")
      # (# container-digest:sha256:....)              <---- CI: check digests are relevant
      #
      #    |
      #    |
      #    v
      # scripts/load_framework_definitions.py
      # (updates the toml
      #  AND
      # creates the resources/all_tasks_irs,
      # records TOML checksum)                        <---- pre-commit guard: checks TOML checksum
      #                                                      pre-commit guard: checks all_tasks_irs checksum
      #    |          \
      #    |           \
      #    |            ------------------->    make docs-build
      #    |                                  (builds docs on the fly)
      #    v
      # scripts/update_readme.py
      # (updates README, records checksum)           <----- pre-commit guard: checks TOML checksum
      # pass_filenames: false means pre-commit does NOT pass filenames as arguments to the script.
      # The script determines which files to check on its own (using auto-detection logic).
      # This is useful when the script needs to check specific files regardless of which files changed.
      - id: check-readme-checksum
        name: "Check README.md checksum matches mapping.toml"
        language: system
        entry: python scripts/check_readme_checksum.py
        files: (README\.md|mapping\.toml)$
        pass_filenames: false
      - id: check-all-tasks-irs-checksum
        name: "Check all_tasks_irs.yaml checksum matches mapping.toml"
        language: system
        entry: python scripts/check_all_tasks_irs_checksum.py
        files: (all_tasks_irs\.yaml|mapping\.toml)$
        pass_filenames: false
